# 最小系统硬件初始化步骤

## 必需的硬件初始化（按优先级排序）

### 1. 栈指针设置 (最高优先级)
```asm
la sp, stack_top    # 设置栈指针
```
**原因**：C函数调用需要栈支持

### 2. BSS段清零 (高优先级)
```asm
la t0, __bss_start
la t1, __bss_end
clear_bss_loop:
    beq t0, t1, clear_bss_done
    sb zero, 0(t0)
    addi t0, t0, 1
    j clear_bss_loop
clear_bss_done:
```
**原因**：C语言标准要求

### 3. UART基本配置 (中等优先级)
```asm
# UART基地址
li t0, 0x10000000

# 简单测试发送字符
li t1, 'H'
sb t1, 0(t0)      # 写入THR寄存器
```
**原因**：调试输出需要

## 可选的硬件初始化

### 4. 中断控制器 (低优先级)
- 最小系统可以禁用所有中断
- 使用轮询方式处理I/O

### 5. 内存管理单元 (可选)
- 最小系统可以直接使用物理地址
- 后续可添加虚拟内存支持

### 6. 时钟配置 (可选)
- 最小系统可以不依赖定时器
- 使用忙等待或轮询

## RISC-V特定初始化

### CSR寄存器设置
```asm
# 禁用中断
csrw mie, zero

# 设置机器模式异常处理
la t0, trap_handler
csrw mtvec, t0

# 配置内存保护(如果需要)
# li t0, 0x1f
# csrw pmpcfg0, t0
```

## 调试验证点

### 启动阶段验证
1. **启动标记**：输出 'S' 表示成功进入_start
2. **栈设置验证**：输出 'P' 表示栈指针设置完成
3. **BSS清零验证**：检查全局变量是否为0
4. **C函数调用验证**：成功调用main()函数 